<!DOCTYPE html>
<html lang="ja">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
  </style>
  <body>
    <style>
      * {
        box-sizing: border-box;
      }
      #app  {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: center;
      }
      #app > div {
        width: 300px;
        height: 100%;
        padding: 1rem;
        border-right: 1px solid #CCCCCC;
      }
      #app textarea {
        height: 16rem;
        font-family: monospace;
        font-size: 14px;
        padding: 10px;
        background: #fafafa;
      }
      #app iframe {
        width: calc(100% - 300px);
        height: 100%;
        border: none;
      }
    </style>

    <div id="app">
      <div>
        <h1>発売日カレンダー</h1>
        <h4>キーワード</h4>
        <textarea name="" id="" cols="30" rows="10" placeholder="本の検索キーワードを入れてください"></textarea>
        <button>設定</button>

        <br /><br />

        <h3>RUST Counter</h3>
        <div>
          <button id="increment-btn">Increment counter</button>
        </div>
        <div id="response"></div>
    
        <script>
          const KEY = 'db-key'
          const incrementBtn = document.querySelector('#increment-btn')
          const responseContainer = document.querySelector('#response')
    
          function updateResponse(response) {
            responseContainer.innerText =
              typeof response === 'string' ? response : JSON.stringify(response)
          }
    
          incrementBtn.addEventListener('click', () => {
            window.__TAURI_INVOKE__('increment_counter')
              .then(updateResponse)
              .catch(updateResponse)
          })
        </script>

        <button id="anotherWindow">別ウィンドウを開く</button>
        <script>
          document.getElementById('anotherWindow').addEventListener('click', () => {
            const webview = new window.__TAURI__.window.WebviewWindow('theUniqueLabel', {
              url: 'https://github.com/tauri-apps/tauri'
            })
          })
        </script>
      </div>
      <iframe src="" frameborder="0" src=""></iframe>
    </div>

    <script>
      const STORAGE_KEY = 'ReleaseCalendarKeywords'
      window.addEventListener('DOMContentLoaded', (event) => {
        const iframe = document.querySelector('#app iframe')
        const textarea = document.querySelector('#app textarea')
        const button = document.querySelector('#app button')
        const savedKeywords = localStorage.getItem(STORAGE_KEY)
        if (savedKeywords) {
          textarea.value = savedKeywords
        } else {
          textarea.value = '偕成社\n講談社\n角川'
        }
        const update = (event) => {
          let url = 'https://deguchi.github.io/bookCalendar/?title='
          let keywords = textarea.value
          if (keywords.match(/\n$/)) keywords = keywords.slice(0, -1)
          const ks = []
          keywords.split('\n').forEach((keyword) => {
            ks.push(encodeURIComponent(keyword))
          })
          iframe.src = url + ks.join('|')
        }
        button.addEventListener('click', () => {
          update()
          localStorage.setItem(STORAGE_KEY, textarea.value)
        })
        update()
      });
    </script>

  </body>
</html>
